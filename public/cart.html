<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>سبد خرید - همگام پلاستیک</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #0B1120;
      color: #cbd5e1;
    }
    .glass-card {
        background: rgba(30, 41, 59, 0.5);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(51, 65, 85, 0.5);
        border-radius: 1rem;
    }
    .btn-whatsapp {
        background: linear-gradient(to right, #25D366, #128C7E);
        color: #ffffff;
        font-weight: 700;
        padding: 0.75rem 2.5rem;
        border-radius: 9999px;
        transition: all 0.3s ease;
    }
    .btn-whatsapp:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: 0 10px 15px -3px rgb(37 211 102 / 0.2);
    }
    .btn-whatsapp:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    /* --- Mobile Menu Fixes --- */
    body.menu-open { overflow: hidden; }
    body.menu-open #mobile-menu { opacity: 1; pointer-events: auto; }
    body.menu-open #logo-link, body.menu-open #cart-link, body.menu-open #user-display { opacity: 0; pointer-events: none; }
    #logo-link, #cart-link, #user-display { transition: opacity 0.3s ease-in-out; }
    body.menu-open #mobile-toggle .fa-bars { display: none; }
    body.menu-open #mobile-toggle .fa-times { display: block; }
  </style>
</head>
<body class="bg-slate-900">

  <header id="main-header" class="sticky top-0 left-0 right-0 z-30 transition-all duration-300 bg-slate-900/80 backdrop-blur-lg shadow-lg py-3">
   <nav class="container mx-auto px-4 sm:px-6 flex justify-between items-center">
    <a href="index.html" id="logo-link" class="w-24 sm:w-28 md:w-32 transition-opacity duration-300">
      <img id="logo-img" src="image/IMG_9482-removebg-preview.png" alt="لوگو شرکت">
    </a>
    <ul class="hidden lg:flex items-center space-x-8 space-x-reverse text-slate-200 font-semibold">
        <li><a href="index.html" class="hover:text-amber-300 transition-colors">خانه</a></li>
        <li><a href="products.html" class="hover:text-amber-300 transition-colors">محصولات</a></li>
        </ul>
    <div class="flex items-center space-x-4 lg:space-x-6 space-x-reverse">
        <a href="cart.html" id="cart-link" class="text-amber-300 text-xl hover:text-amber-300 transition-colors relative">
          <i class="fas fa-shopping-cart"></i>
          <span id="cart-counter" class="absolute -top-2 -right-3 bg-yellow-400 text-slate-900 text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold" style="display: none;">0</span>
        </a>
        <div id="user-display">
            </div>
        <button id="mobile-toggle" class="lg:hidden text-white text-2xl z-50">
          <i class="fas fa-bars block"></i>
          <i class="fas fa-times hidden"></i>
        </button>
    </div>
  </nav>
</header>
  
  <div id="mobile-menu" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-40 p-8 text-white text-center transition-opacity duration-300 ease-in-out opacity-0">
    </div>

  <main>
    <section class="relative py-24 md:py-32 flex items-center justify-center text-white overflow-hidden bg-slate-800">
        <div class="absolute inset-0 bg-cover bg-center opacity-10" style="background-image: url('https://images.pexels.com/photos/8947623/pexels-photo-8947623.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');"></div>
        <div class="relative z-10 text-center px-6">
            <h1 class="text-4xl md:text-6xl font-black leading-tight mb-4">سبد خرید شما</h1>
        </div>
    </section>

    <div class="container mx-auto px-6 py-16">
        <div id="cart-content" class="grid lg:grid-cols-3 gap-8 items-start">
            <div id="cart-items-list" class="lg:col-span-2 space-y-6">
                </div>

            <aside class="lg:col-span-1 glass-card p-6 lg:sticky lg:top-28">
                <h3 class="text-2xl font-bold text-white mb-6 border-b border-slate-700 pb-4">خلاصه سفارش</h3>
                <div class="space-y-4 text-slate-300">
                    <div class="flex justify-between"><span>جمع محصولات</span><span id="subtotal">۰ تومان</span></div>
                    <div class="flex justify-between"><span>هزینه ارسال</span><span id="shipping">۰ تومان</span></div>
                    <div class="flex justify-between border-t border-slate-700 pt-4 mt-4 font-bold text-white text-lg"><span>مبلغ نهایی</span><span id="total">۰ تومان</span></div>
                </div>
                <div class="mt-6">
                    <button id="whatsapp-checkout-btn" class="w-full text-center btn-whatsapp">
                        <i class="fab fa-whatsapp mr-2"></i>
                        ثبت سفارش در واتس‌اپ
                    </button>
                </div>
            </aside>
        </div>
    </div>
  </main>
  
  <footer class="bg-slate-900 border-t border-slate-800 text-slate-400">
      </footer>

<script src="myjs.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const cartItemsList = document.getElementById('cart-items-list');
    const subtotalEl = document.getElementById('subtotal');
    const shippingEl = document.getElementById('shipping');
    const totalEl = document.getElementById('total');
    const whatsappBtn = document.getElementById('whatsapp-checkout-btn');
    const cart = window.App.cart;

    function formatPrice(price) {
        return (price || 0).toLocaleString('fa-IR') + ' تومان';
    }

    function renderCart() {
        const cartData = cart.get();
        cartItemsList.innerHTML = '';

        if (cartData.length === 0) {
            cartItemsList.innerHTML = `
                <div class="glass-card p-8 text-center">
                    <i class="fas fa-shopping-cart text-5xl text-slate-600 mb-4"></i>
                    <h3 class="text-2xl font-bold text-white mb-2">سبد خرید شما خالی است</h3>
                    <p class="text-slate-400 mb-6">به نظر می‌رسد هنوز محصولی به سبد خرید خود اضافه نکرده‌اید.</p>
                    <a href="products.html" class="inline-block bg-amber-400 text-slate-900 font-bold py-2 px-6 rounded-full hover:bg-amber-300 transition-colors">مشاهده محصولات</a>
                </div>
            `;
            whatsappBtn.disabled = true;
            updateSummary(0);
            return;
        }

        whatsappBtn.disabled = false;
        let subtotal = 0;
        cartData.forEach(item => {
            subtotal += item.price * item.quantity;
            const itemEl = document.createElement('div');
            itemEl.className = 'glass-card flex flex-col sm:flex-row items-center p-4 gap-4';
            itemEl.innerHTML = `
                <img src="${item.image}" alt="${item.name}" class="w-24 h-24 object-contain bg-slate-700/50 rounded-md">
                <div class="flex-grow text-center sm:text-right">
                    <h4 class="font-bold text-white text-lg">${item.name}</h4>
                    <p class="text-sm text-slate-400">${formatPrice(item.price)}</p>
                </div>
                <div class="flex items-center gap-2 bg-slate-700/50 rounded-full p-1 my-2 sm:my-0">
                    <button class="quantity-btn w-8 h-8 rounded-full hover:bg-slate-600 transition-colors" data-id="${item.id}" data-change="1">+</button>
                    <input type="number" value="${item.quantity}" min="1" class="quantity-input w-12 bg-transparent text-center font-bold text-white" data-id="${item.id}">
                    <button class="quantity-btn w-8 h-8 rounded-full hover:bg-slate-600 transition-colors" data-id="${item.id}" data-change="-1">-</button>
                </div>
                <div class="w-32 text-center sm:text-left">
                    <p class="font-bold text-white text-lg">${formatPrice(item.price * item.quantity)}</p>
                </div>
                <button class="remove-btn text-slate-500 hover:text-red-400 transition-colors text-xl" data-id="${item.id}"><i class="fas fa-trash-alt"></i></button>
            `;
            cartItemsList.appendChild(itemEl);
        });

        updateSummary(subtotal);
    }
    
    function updateSummary(subtotal) {
        const shippingCost = subtotal > 0 ? 50000 : 0;
        const total = subtotal + shippingCost;
        subtotalEl.textContent = formatPrice(subtotal);
        shippingEl.textContent = formatPrice(shippingCost);
        totalEl.textContent = formatPrice(total);
    }

    cartItemsList.addEventListener('click', e => {
        const target = e.target.closest('button');
        if (!target) return;
        const productId = target.dataset.id;
        if (target.classList.contains('quantity-btn')) {
            const currentItem = cart.get().find(item => item.id === productId);
            if (currentItem) {
                const change = parseInt(target.dataset.change);
                cart.updateQuantity(productId, currentItem.quantity + change);
                renderCart();
            }
        } else if (target.classList.contains('remove-btn')) {
            cart.remove(productId);
            renderCart();
        }
    });
    
    cartItemsList.addEventListener('change', e => {
        if(e.target.classList.contains('quantity-input')) {
            const productId = e.target.dataset.id;
            const newQuantity = parseInt(e.target.value);
            cart.updateQuantity(productId, newQuantity);
            renderCart();
        }
    });
    
    whatsappBtn.addEventListener('click', () => {
        const cartData = cart.get();
        if (cartData.length === 0) return;

        let subtotal = 0;
        let invoiceText = "سلام، قصد خرید محصولات زیر را دارم:\n\n";
        
        cartData.forEach(item => {
            invoiceText += `*${item.name}*\n`;
            invoiceText += `تعداد: ${item.quantity}\n\n`;
            subtotal += item.price * item.quantity;
        });

        const shippingCost = subtotal > 0 ? 50000 : 0;
        const total = subtotal + shippingCost;

        invoiceText += `\n----------------------\n*مبلغ نهایی: ${formatPrice(total)}*`;

        const phoneNumber = "989113189607"; // ✅ FIX: Updated to the correct number
        const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(invoiceText)}`;
        
        window.open(whatsappUrl, '_blank');
    });

    renderCart();
});
</script>

</body>
</html>